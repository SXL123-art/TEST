
#include <string.h>
#include <stdio.h>
#include "./../../public/globals.h"

//#ifdef USE_QRCODE

#include "define.h"
#include "ext_var.h"
#include "ext_fun.h"

#include "bar_print.h"
#include "qrencode.h"
#include "./../print.h"


#define OUT_FILE_PIXEL_PRESCALER	4			// Prescaler (number of pixels in bmp file for each QRCode pixel, on each dimension)
#define PIXEL_COLOR_R				0xff		// Color of bmp pixels
#define PIXEL_COLOR_G				0
#define PIXEL_COLOR_B				0
#define BI_RGB			            		0L


#pragma pack(push, 2)


typedef struct
{
	unsigned short bfType;
	unsigned long  bfSize;
	unsigned short bfReserved1;
	unsigned short bfReserved2;
	unsigned long bfOffBits;
} BITMAPFILEHEADER;

typedef struct
{
	unsigned long biSize;
	signed long biWidth;
	signed long biHeight;
	unsigned short biPlanes;
	unsigned short biBitCount;
	unsigned long biCompression;
	unsigned long biSizeImage;
	signed long biXPelsPerMeter;
	signed long biYPelsPerMeter;
	unsigned long biClrUsed;
	unsigned long biClrImportant;
} BITMAPINFOHEADER;

#pragma pack(pop)

unsigned char imgdata[] =
    {   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xFF, 0xFF, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0xFF, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0xFF, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0xFF, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0xFF, 0xFF, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0xFF, 0xFF, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFC, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFE, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xFF, 0xFC, 0x7F, 0xFE, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xFF, 0xF0, 0x1F, 0xFE, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xFF, 0xE0, 0x1F, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xFF, 0xE0, 0x0F, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xFF, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xFF, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xFF, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xFF, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x3E, 0x07, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x07, 0xFE, 0x0F, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x1F, 0xFC, 0x0F, 0xFF, 0x00, 0x03, 0xFF, 0xFF, 0xFF, 0xF0, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x1F, 0xFC, 0x1F, 0xFE, 0x00, 0x01, 0xFF, 0xFF, 0xFF, 0xF0, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x7F, 0xFC, 0x1F, 0xFE, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xF0, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0xFF, 0xFC, 0x1F, 0xFE, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xF8, 0x00, 0x00, 0x00,
0x00, 0x00, 0x01, 0xFF, 0xF8, 0x1F, 0xFC, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFC, 0x00, 0x00, 0x00,
0x00, 0x00, 0x01, 0xFF, 0xF8, 0x1F, 0xFC, 0x00, 0x00, 0x7F, 0xFF, 0xFF, 0xFC, 0x00, 0x00, 0x00,
0x00, 0x00, 0x03, 0xFF, 0xF8, 0x3F, 0xFC, 0x00, 0x00, 0x7F, 0xFF, 0xFF, 0xFE, 0x00, 0x00, 0x00,
0x00, 0x00, 0x03, 0xFF, 0xF0, 0x3F, 0xF8, 0x00, 0x00, 0x7F, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00,
0x00, 0x00, 0x07, 0xFF, 0xF0, 0x7F, 0xF8, 0x00, 0x00, 0x3F, 0xFF, 0xFF, 0xFF, 0x80, 0x00, 0x00,
0x00, 0x00, 0x07, 0xFF, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0x80, 0x00, 0x00,
0x00, 0x00, 0x0F, 0xFF, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xFF, 0xC0, 0x00, 0x00,
0x00, 0x00, 0x0F, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xFF, 0xC0, 0x00, 0x00,
0x00, 0x00, 0x0F, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xFF, 0xC0, 0x00, 0x00,
0x00, 0x00, 0x0F, 0xFE, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xFF, 0xC0, 0x00, 0x00,
0x00, 0x00, 0x0F, 0xFE, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xFF, 0xC0, 0x00, 0x00,
0x00, 0x00, 0x0F, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xFF, 0xC0, 0x00, 0x00,
0x00, 0x00, 0x0F, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xFF, 0xC0, 0x00, 0x00,
0x00, 0x00, 0x0F, 0xFF, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xFF, 0xC0, 0x00, 0x00,
0x00, 0x00, 0x07, 0xFF, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xFF, 0xC0, 0x00, 0x00,
0x00, 0x00, 0x07, 0xFF, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xFF, 0xC0, 0x00, 0x00,
0x00, 0x00, 0x03, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xFF, 0x80, 0x00, 0x00,
0x00, 0x00, 0x03, 0xFF, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x83, 0xFF, 0x00, 0x00, 0x00,
0x00, 0x00, 0x01, 0xFF, 0xFC, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x83, 0xFF, 0x00, 0x00, 0x00,
0x00, 0x00, 0x01, 0xFF, 0xFF, 0x80, 0x00, 0x00, 0x00, 0x00, 0x1F, 0xC1, 0xFF, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0xFF, 0xFF, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x1F, 0xE1, 0xFC, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x7F, 0xFF, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x3F, 0xC1, 0xF0, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x3F, 0xFF, 0xF8, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xE1, 0xF0, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x1F, 0xFF, 0xFC, 0x00, 0x00, 0x00, 0x01, 0xFF, 0xE0, 0x50, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x0F, 0xFF, 0xFE, 0x00, 0x00, 0x00, 0x01, 0xFF, 0xE0, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x03, 0xFF, 0xFC, 0x00, 0x00, 0x00, 0x01, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x01, 0xFF, 0xFC, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0xFF, 0xFC, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x1F, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x7F, 0xF0, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x1F, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x7F, 0xF8, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x07, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x3F, 0xF8, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x03, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x3F, 0xF8, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x01, 0xB0, 0x00, 0x00, 0x00, 0x00, 0x3F, 0xFC, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x01, 0x00, 0x70, 0x00, 0x00, 0x00, 0x00, 0x1F, 0xFC, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x01, 0xE0, 0x30, 0x00, 0x00, 0x00, 0x00, 0x1F, 0xFC, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x01, 0xF0, 0x00, 0x00, 0x03, 0x00, 0x00, 0x1F, 0xFE, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x03, 0xF8, 0x00, 0x00, 0x07, 0x80, 0x00, 0x1F, 0xFE, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x03, 0xFC, 0x00, 0x00, 0x0F, 0xE0, 0x00, 0x1F, 0xFE, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x03, 0xFF, 0x00, 0x00, 0x1F, 0xF0, 0x00, 0x1F, 0xFE, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x03, 0xFF, 0x80, 0x00, 0x3F, 0xF0, 0x00, 0x0F, 0xFF, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x03, 0xFF, 0x80, 0x00, 0x7F, 0xFC, 0x00, 0x0F, 0xFF, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x03, 0xFF, 0x80, 0x01, 0xFF, 0xFE, 0x00, 0x0F, 0xFF, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x03, 0xFF, 0xC0, 0x07, 0xFF, 0xFF, 0x80, 0x1F, 0xFF, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x03, 0xFF, 0xE0, 0x1F, 0xFF, 0xFE, 0x00, 0x1F, 0xFE, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x03, 0xFF, 0xF0, 0x1F, 0xFF, 0xF8, 0x00, 0x1F, 0xFE, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x01, 0xFF, 0xF0, 0x7F, 0xFF, 0xF0, 0x00, 0x3F, 0xFE, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x01, 0xFF, 0xFF, 0xFF, 0xFF, 0xE0, 0x1C, 0xFF, 0xFC, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x01, 0xFF, 0xFF, 0xFF, 0xFF, 0xC0, 0x3F, 0xFF, 0xFC, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x80, 0x7F, 0xFF, 0xFC, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFE, 0x03, 0xFF, 0xFF, 0xF8, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x3F, 0xFF, 0xFF, 0xF8, 0x07, 0xFF, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x1F, 0xFF, 0xFF, 0xF0, 0x1F, 0xFF, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00,
0x04, 0x00, 0x00, 0x00, 0x1F, 0xFF, 0xFF, 0xE0, 0x1F, 0xFF, 0xFF, 0xE0, 0x00, 0x00, 0x00, 0x80,
0x04, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0xFF, 0xC0, 0x1F, 0xFF, 0xFF, 0xC0, 0x00, 0x00, 0x00, 0x80,
0x04, 0x00, 0x00, 0x00, 0x03, 0xFF, 0xFF, 0x00, 0x07, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x80,
0x06, 0x00, 0x00, 0x00, 0x01, 0xFF, 0xFC, 0x00, 0x03, 0xFF, 0xFE, 0x00, 0x00, 0x00, 0x01, 0x80,
0x07, 0x00, 0x00, 0x00, 0x00, 0x7F, 0xF0, 0x00, 0x00, 0xFF, 0xF8, 0x00, 0x00, 0x00, 0x03, 0x80,
0x07, 0x80, 0x00, 0x00, 0x00, 0x0F, 0xC0, 0x00, 0x00, 0x1F, 0xF0, 0x00, 0x00, 0x00, 0x07, 0x80,
0x07, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x80,
0x07, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x80,
0x03, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x00,
0x03, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x00,
0x03, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00,
0x03, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x00,
0x01, 0xFC, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFE, 0x00,
0x01, 0xFF, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xFE, 0x00,
0x00, 0xFF, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0xFC, 0x00,
0x00, 0x7F, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0xF8, 0x00,
0x00, 0x3F, 0xFF, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0xFF, 0xF0, 0x00,
0x00, 0x1F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xF0, 0x00,
0x00, 0x1F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xF0, 0x00,
0x00, 0x1F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xE0, 0x00,
0x00, 0x0F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xC0, 0x00,
0x00, 0x01, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFE, 0x00, 0x00,
0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFC, 0x00, 0x00,
0x00, 0x00, 0x3F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xF0, 0x00, 0x00,
0x00, 0x00, 0x1F, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xF0, 0x00, 0x00,
0x00, 0x00, 0x07, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x80, 0x00, 0x00,
0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFC, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x11, 0xC0, 0x00, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x30, 0x01, 0x8C, 0x60, 0x00, 0x00,
0x00, 0x00, 0x11, 0x80, 0x00, 0x0C, 0x00, 0x00, 0x01, 0x80, 0x20, 0x01, 0xCC, 0x4F, 0xE0, 0x00,
0x00, 0x00, 0x11, 0x80, 0x10, 0x0E, 0x02, 0x00, 0x00, 0xC0, 0x20, 0x00, 0xEE, 0x4C, 0x60, 0x00,
0x00, 0x00, 0x11, 0x80, 0x1F, 0xFF, 0xFF, 0x1F, 0xF0, 0x63, 0xFF, 0x80, 0x60, 0xCC, 0x60, 0x00,
0x00, 0x00, 0x11, 0x82, 0x00, 0x01, 0x00, 0x18, 0x00, 0x32, 0x01, 0x80, 0x1F, 0xFC, 0x60, 0x00,
0x00, 0x00, 0x11, 0x87, 0x01, 0xFF, 0xF0, 0x10, 0x00, 0x02, 0x01, 0x82, 0x03, 0x0F, 0xE0, 0x00,
0x00, 0x0F, 0xF1, 0xDE, 0x01, 0xFF, 0xF0, 0x10, 0x00, 0x03, 0xFF, 0x87, 0x83, 0x0F, 0xE0, 0x00,
0x00, 0x0F, 0xF1, 0xD8, 0x01, 0x80, 0x10, 0x10, 0x00, 0x03, 0xFF, 0x81, 0xD3, 0x7C, 0x60, 0x00,
0x00, 0x00, 0x31, 0xF0, 0x01, 0x80, 0x10, 0x10, 0x03, 0xF2, 0x00, 0x00, 0x93, 0x6C, 0x60, 0x00,
0x00, 0x00, 0x11, 0xC0, 0x01, 0x80, 0x10, 0x1F, 0xE0, 0x32, 0x00, 0x00, 0x13, 0x6C, 0x60, 0x00,
0x00, 0x00, 0x11, 0x80, 0x01, 0x80, 0x10, 0x1F, 0xE0, 0x33, 0xFF, 0x80, 0x13, 0x6C, 0x60, 0x00,
0x00, 0x00, 0x11, 0x80, 0x01, 0xFF, 0xF0, 0x10, 0x00, 0x32, 0x01, 0xC0, 0x13, 0x7C, 0xE0, 0x00,
0x00, 0x00, 0x11, 0x80, 0x01, 0x5F, 0xF0, 0x10, 0x00, 0x32, 0x01, 0xC0, 0xDF, 0xFF, 0xE0, 0x00,
0x00, 0x00, 0x11, 0x80, 0x00, 0xCE, 0x20, 0x10, 0x00, 0x33, 0xFF, 0xC0, 0x92, 0x78, 0x60, 0x00,
0x00, 0x00, 0x11, 0x80, 0x00, 0xCE, 0x70, 0x10, 0x00, 0x33, 0xFF, 0xC0, 0x82, 0x08, 0x60, 0x00,
0x00, 0x00, 0x71, 0x80, 0x01, 0x8E, 0x30, 0x10, 0x00, 0x32, 0x01, 0xC1, 0x86, 0x18, 0x60, 0x00,
0x00, 0x07, 0xF1, 0x81, 0x03, 0x0E, 0x18, 0x1F, 0xF0, 0x32, 0x00, 0x01, 0x06, 0x10, 0x60, 0x00,
0x00, 0x0C, 0x11, 0xC3, 0x0E, 0x0E, 0x1C, 0x1F, 0xF0, 0xD0, 0x00, 0x03, 0x0C, 0x10, 0x60, 0x00,
0x00, 0x08, 0x10, 0xFF, 0x1C, 0x06, 0x0E, 0x00, 0x01, 0x8F, 0xE0, 0x63, 0x18, 0x33, 0xE0, 0x00,
0x00, 0x00, 0x10, 0xFE, 0x08, 0x3C, 0x04, 0x00, 0x03, 0x03, 0xFF, 0xE3, 0x30, 0x71, 0xC0, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00

    };

int Save_QEImage(char* szSourceSring)
{
	unsigned int unWidth, x, y, l, n, unWidthAdjusted, unDataBytes;
	unsigned char* pRGBData, *pSourceData, *pDestData;
	QRcode*	pQRC;
	FILE* f;
	
    	// Compute QRCode
	if  (pQRC = QRcode_encodeString(szSourceSring, 0, QR_ECLEVEL_H, QR_MODE_8, 1))
	{
		unWidth = pQRC->width;
		unWidthAdjusted = unWidth * OUT_FILE_PIXEL_PRESCALER * 3;
		
		if (unWidthAdjusted % 4)
		{
			unWidthAdjusted = (unWidthAdjusted / 4 + 1) * 4;
		}
		unDataBytes = unWidthAdjusted * unWidth * OUT_FILE_PIXEL_PRESCALER;
		
		// Allocate pixels buffer
		if (!(pRGBData = (unsigned char*)malloc(unDataBytes)))
		{
			printf("Out of memory");
			return 1;
		}
		
		// Preset to white
		memset(pRGBData, 0xff, unDataBytes);
		
		// Prepare bmp headers
		BITMAPFILEHEADER kFileHeader;
		kFileHeader.bfType = 0x4d42;  // "BM"
		kFileHeader.bfSize = sizeof(BITMAPFILEHEADER) + sizeof(BITMAPINFOHEADER) + unDataBytes;
		kFileHeader.bfReserved1 = 0;
		kFileHeader.bfReserved2 = 0;
		kFileHeader.bfOffBits =	sizeof(BITMAPFILEHEADER) + sizeof(BITMAPINFOHEADER);

		BITMAPINFOHEADER kInfoHeader;
		kInfoHeader.biSize = sizeof(BITMAPINFOHEADER);
		kInfoHeader.biWidth = unWidth * OUT_FILE_PIXEL_PRESCALER;
		kInfoHeader.biHeight = -((int)unWidth * OUT_FILE_PIXEL_PRESCALER);
		kInfoHeader.biPlanes = 1;
		kInfoHeader.biBitCount = 24;
		kInfoHeader.biCompression = BI_RGB;
		kInfoHeader.biSizeImage = 0;
		kInfoHeader.biXPelsPerMeter = 0;
		kInfoHeader.biYPelsPerMeter = 0;
		kInfoHeader.biClrUsed = 0;
		kInfoHeader.biClrImportant = 0;
		
		// Convert QrCode bits to bmp pixels
		pSourceData = pQRC->data;
		for (y = 0; y < unWidth; y++)
		{
			pDestData = pRGBData + unWidthAdjusted * y * OUT_FILE_PIXEL_PRESCALER;
			for (x = 0; x < unWidth; x++)
			{
				if (*pSourceData & 1)
				{
					for (l = 0; l < OUT_FILE_PIXEL_PRESCALER; l++)
					{
						for (n = 0; n < OUT_FILE_PIXEL_PRESCALER; n++)
						{
							*(pDestData + n * 3 + unWidthAdjusted * l) = PIXEL_COLOR_B;
							*(pDestData + 1 + n * 3 + unWidthAdjusted * l) = PIXEL_COLOR_G;
							*(pDestData + 2 + n * 3 + unWidthAdjusted * l) = PIXEL_COLOR_R;
						}
					}
				}
				pDestData += 3 * OUT_FILE_PIXEL_PRESCALER;
				pSourceData++;
			}
		}

		// Output the bmp file
		//f = fopen(QT_OUT_FILE,"wb");
		f = fopen(QT_OUT_FILE,"ab++");
		if (f != NULL)
		{
			fwrite(&kFileHeader, sizeof(BITMAPFILEHEADER), 1, f);
			fwrite(&kInfoHeader, sizeof(BITMAPINFOHEADER), 1, f);
			fwrite(pRGBData, sizeof(unsigned char), unDataBytes, f);

			fclose(f);
		}
		else
		{
			printf("Unable to open file\n");
			return 1;
		}
		
		// Free data
		free(pRGBData);
		QRcode_free(pQRC);
	}
	else
	{
		printf("NULL returned");
		return 1;
	}

	return 0;
}

void Print_QRCode(unsigned char *str)
{
	printf("Save QEImage... \n");
	Save_QEImage(str);
	
	QRcode* qrcode;
	int width;
	int x, y, i = 0;
	int h, w = 0;
	int border;
	unsigned char* qdata;
	int index, byte_x, bit_x;
	unsigned short strprt;
	char *pBar_QtPrtDat;
	int total_height, remain_height;
	int start_index;

	qrcode = QRcode_encodeString8bit((const char *)str, 0, QR_ECLEVEL_L);
	width = qrcode->width;
	qdata = qrcode->data;
	printf("%d %d:width,version\n",qrcode->width,qrcode->version);
	strprt = 383;

	Bar_tab.BAR_Encode = BARTYP_EAN13;
	Bar_tab.Num_Pos = NUM_DOWN;
	Bar_tab.BarPosition = Middle;
	Bar_tab.x_mulriple = 2;
	Bar_tab.bar_heigh = 50;
	
    switch(Bar_tab.x_mulriple)
    {
        case 1:
            border = 4;
            break;
        case 2:
            border = 6;
            break;
        case 3:
            border = 8;
            break;
        default:
            border = 6;
			break;
    }
    if (border > 8) border = 8;

    switch(Bar_tab.BarPosition)
    {
        case Left:
            Bar_tab.start_position = 1;
            break;
        case Middle:
            Bar_tab.start_position = (strprt - width * border)/2;
            break;
        case Right:
            Bar_tab.start_position = strprt - width * border;
            break;
        default:
            Bar_tab.start_position = 1;
            break;
    }

//printf("width=%d\n", width);
	if (width * border > TPH_LINE_BYTES * 8)
	{
		QRcode_free(qrcode);

		return;
	}

	start_index = (TPH_DOTS_PER_LINE*TPH_LINE_BYTES) * (prt_line-1);

	//quiet zone(top)
	index = 0;
	for (y = 0; y < border * 4; y++)
	{
		memset(&patternBuf[start_index + index], 0, TPH_LINE_BYTES);
		index += TPH_LINE_BYTES;
	}

	pBar_QtPrtDat = &patternBuf[start_index + TPH_LINE_BYTES * border * 4];
	memset(pBar_QtPrtDat, 0, TPH_LINE_BYTES*width*border); // + quiet zone(bottom)

	for (y = 0; y < width; y++)
	{
		for (x = 0; x < width; x++, i++)
		{
			for (h = 0; h < border; h++)
			{
				for (w = 0; w < border; w++)
				{
					index = (x * border + w + Bar_tab.start_position);
					index += ((y * border + h) * TPH_LINE_BYTES) * 8;

					byte_x = index / 8;
					bit_x = 7 - index % 8;

					pBar_QtPrtDat[byte_x] |= (qdata[i] & 0x01) << bit_x;
				}
			}
		}
	}
	QRcode_free(qrcode);

	total_height = (width + 4 + 4 ) * border; // two quiet zone + data
	remain_height = TPH_DOTS_PER_LINE - (total_height % TPH_DOTS_PER_LINE);
//printf("th=%d, rh=%d\n", total_height, remain_height);
	//quiet zone(bottom)
	index = 0;
	for (y = 0; y < border * 4 + remain_height; y++) // quiet zone +
	{
		memset(&patternBuf[start_index + TPH_LINE_BYTES * border * (4 + width) + index], 0, TPH_LINE_BYTES);
		index += TPH_LINE_BYTES;

	}
	prt_line += (total_height + remain_height) / TPH_DOTS_PER_LINE - 1;
}
/*
void Print_HanXinCode(unsigned char *str)
{
	//QRcode* qrcode;
	int width;
	int x, y, i = 0;
	int h, w = 0;
	int border;
	//unsigned char* qdata;
	int index, byte_x, bit_x;
    unsigned short strprt;
    char *pBar_QtPrtDat;
    int total_height, remain_height;
    int start_index;

	int *piWidth = &width;

	unsigned char bb[4000];
	//bb = (unsigned char*) malloc(sizeof(unsigned char) * 40000);

	if(!EnCsText((const char *)str, bb, piWidth))
	{
		printf("the encoding for case 1 fail! \n");
		return;

	}

    printf("the encoding for case 1 success! \n");
    //width = qrcode->width;
    //qdata = qrcode->data;
    //printf("%d %d:width,version\n",qrcode->width,qrcode->version);
    strprt = 383;
    switch(Bar_tab.x_mulriple)
    {
        case 1:
            border = 4;
            break;
        case 2:
            border = 6;
            break;
        case 3:
            border = 8;
            break;
        default:
            border = 6;
			break;
    }
    if (border > 8) border = 8;

    switch(Bar_tab.BarPosition)
    {
        case Left:
            Bar_tab.start_position = 1;
            break;
        case Middle:
            Bar_tab.start_position = (strprt - width * border)/2;
            break;
        case Right:
            Bar_tab.start_position = strprt - width * border;
            break;
        default:
            Bar_tab.start_position = 1;
            break;
    }

//printf("width=%d\n", width);
	if (width * border > TPH_LINE_BYTES * 8)
	{
		return;
	}

	start_index = (TPH_DOTS_PER_LINE*TPH_LINE_BYTES) * (prt_line-1);

	//quiet zone(top)
	index = 0;
	for (y = 0; y < border * 4; y++)
	{
		memset(&patternBuf[start_index + index], 0, TPH_LINE_BYTES);
		index += TPH_LINE_BYTES;
	}

	pBar_QtPrtDat = &patternBuf[start_index + TPH_LINE_BYTES * border * 4];
	memset(pBar_QtPrtDat, 0, TPH_LINE_BYTES*width*border); // + quiet zone(bottom)

	for (y = 0; y < width; y++)
	{
		for (x = 0; x < width; x++, i++)
		{
			for (h = 0; h < border; h++)
			{
				for (w = 0; w < border; w++)
				{
					index = (x * border + w + Bar_tab.start_position);
					index += ((y * border + h) * TPH_LINE_BYTES) * 8;

					byte_x = index / 8;
					bit_x = 7 - index % 8;

					pBar_QtPrtDat[byte_x] |= (bb[i] & 0x01) << bit_x;
				}
			}
		}
	}

	total_height = (width + 4 + 4 ) * border; // two quiet zone + data
	remain_height = TPH_DOTS_PER_LINE - (total_height % TPH_DOTS_PER_LINE);
//printf("th=%d, rh=%d\n", total_height, remain_height);
	//quiet zone(bottom)
	index = 0;
	for (y = 0; y < border * 4 + remain_height; y++) // quiet zone +
	{
		memset(&patternBuf[start_index + TPH_LINE_BYTES * border * (4 + width) + index], 0, TPH_LINE_BYTES);
		index += TPH_LINE_BYTES;

	}
	prt_line += (total_height + remain_height) / TPH_DOTS_PER_LINE;
}
*/
void Print_Img(void)
{	 
	printf("in Print_Img\n");	
	int width = 16;//bmp byte perline	
	int height = 133;//bmp line num 
	int x, y,h = 0; 
	int border = 1;
	Bar_tab.start_position = 16;	
	int start_index = 0;	
	printf("in Print_Img start_index=%d\n",start_index);	
	char *pBar_QtPrtDat = &patternBuf[start_index + TPH_LINE_BYTES * border];	
	memset(pBar_QtPrtDat, 0, TPH_LINE_BYTES*height*border); 
	// + quiet zone(bottom) 
	int index = 0;	for (y = 0; y < height; y++)//115	
	{		
		for (x = 0; x < width; x++)//12 	
		{			
			for (h = 0; h < border; h++)			
			{				
				index = x+Bar_tab.start_position;				
				//index = (x * border + w + Bar_tab.start_position);
				index += ((y * border + h) * TPH_LINE_BYTES);				 
				pBar_QtPrtDat[index] = imgdata[y*16+x]; 	
			}		
		}	
	}	
	printf("in Print_Img after for loop\n");	
	prt_line += 6;
}

//#endif

